"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[47],{9023(e,n,i){i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"vector-search-hybrid","title":"Vector Search and Hybrid Retrieval in Elasticsearch","description":"A production-focused guide to implement hybrid search using lexical (BM25) and semantic (vector) retrieval in Elasticsearch.","source":"@site/docs/docs/vector-search-hybrid.md","sourceDirName":".","slug":"/vector-search-hybrid","permalink":"/docs/vector-search-hybrid","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Vector Search and Hybrid Retrieval in Elasticsearch","sidebar_position":2,"description":"A production-focused guide to implement hybrid search using lexical (BM25) and semantic (vector) retrieval in Elasticsearch."},"sidebar":"docsSidebar","previous":{"title":"Documentation","permalink":"/docs/intro"},"next":{"title":"Articles that I wrote for DigitalOcean","permalink":"/docs/do-articles"}}');var s=i(4848),c=i(8453);const a={title:"Vector Search and Hybrid Retrieval in Elasticsearch",sidebar_position:2,description:"A production-focused guide to implement hybrid search using lexical (BM25) and semantic (vector) retrieval in Elasticsearch."},l="Vector Search and Hybrid Retrieval in Elasticsearch",t={},d=[{value:"Tested in Elastic Cloud (Kibana Console)",id:"tested-in-elastic-cloud-kibana-console",level:2},{value:"1. Why Hybrid Retrieval Matters",id:"1-why-hybrid-retrieval-matters",level:2},{value:"2. Lexical vs Semantic Search",id:"2-lexical-vs-semantic-search",level:2},{value:"Lexical Search (BM25)",id:"lexical-search-bm25",level:3},{value:"Semantic Search (Vector Search)",id:"semantic-search-vector-search",level:3},{value:"3. Hybrid Retrieval Architecture",id:"3-hybrid-retrieval-architecture",level:2},{value:"4. Creating an Index with Dense Vectors",id:"4-creating-an-index-with-dense-vectors",level:2},{value:"Creating an index with dense vectors",id:"creating-an-index-with-dense-vectors",level:2},{value:"Verifying index creation in Elasticsearch Cloud",id:"verifying-index-creation-in-elasticsearch-cloud",level:3},{value:"5. Ingesting Documents with Embeddings",id:"5-ingesting-documents-with-embeddings",level:2},{value:"Ingesting a document with a dense vector field",id:"ingesting-a-document-with-a-dense-vector-field",level:3},{value:"6. Performing Vector Search (kNN)",id:"6-performing-vector-search-knn",level:2},{value:"Executing a hybrid search query",id:"executing-a-hybrid-search-query",level:3},{value:"7. Implementing Hybrid Queries",id:"7-implementing-hybrid-queries",level:2},{value:"8. Performance and Scaling Considerations",id:"8-performance-and-scaling-considerations",level:2},{value:"9. Production Pitfalls",id:"9-production-pitfalls",level:2},{value:"10. When to Use Hybrid Retrieval",id:"10-when-to-use-hybrid-retrieval",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"vector-search-and-hybrid-retrieval-in-elasticsearch",children:"Vector Search and Hybrid Retrieval in Elasticsearch"})}),"\n",(0,s.jsxs)(n.p,{children:["Search systems combine ",(0,s.jsx)(n.strong,{children:"lexical relevance"})," with ",(0,s.jsx)(n.strong,{children:"semantic similarity"})," to improve retrieval quality. Elasticsearch supports both approaches natively for production-grade hybrid search systems for AI applications, RAG pipelines, and knowledge retrieval."]}),"\n",(0,s.jsx)(n.p,{children:"This guide covers:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Lexical vs semantic retrieval"}),"\n",(0,s.jsx)(n.li,{children:"Dense vector indexing"}),"\n",(0,s.jsx)(n.li,{children:"kNN search in Elasticsearch"}),"\n",(0,s.jsx)(n.li,{children:"Hybrid query strategies"}),"\n",(0,s.jsx)(n.li,{children:"Performance and production considerations"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"tested-in-elastic-cloud-kibana-console",children:"Tested in Elastic Cloud (Kibana Console)"}),"\n",(0,s.jsxs)(n.p,{children:["The examples in this guide were validated in an Elasticsearch Dev tools->Console deployment using Kibana \u2192 Dev Tools \u2192 Console.\nI created a sample index with a ",(0,s.jsx)(n.code,{children:"dense_vector"})," field, indexed example documents, and compared BM25-only, kNN-only, and hybrid retrieval results."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"1-why-hybrid-retrieval-matters",children:"1. Why Hybrid Retrieval Matters"}),"\n",(0,s.jsx)(n.p,{children:"Traditional search systems rely on keyword matching (BM25). While effective for exact matches, lexical search struggles with:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Synonyms"}),"\n",(0,s.jsx)(n.li,{children:"Conceptual similarity"}),"\n",(0,s.jsx)(n.li,{children:"Vocabulary mismatch"}),"\n",(0,s.jsx)(n.li,{children:"Natural language queries"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Vector search improves recall by retrieving semantically similar documents. However, pure semantic search may reduce precision."}),"\n",(0,s.jsx)(n.p,{children:"Hybrid retrieval combines:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Precision"})," from lexical scoring"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Recall"})," from semantic similarity"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This approach is foundational for modern AI-powered search systems."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"2-lexical-vs-semantic-search",children:"2. Lexical vs Semantic Search"}),"\n",(0,s.jsx)(n.h3,{id:"lexical-search-bm25",children:"Lexical Search (BM25)"}),"\n",(0,s.jsx)(n.p,{children:"Elasticsearch\u2019s default scoring algorithm is BM25."}),"\n",(0,s.jsx)(n.p,{children:"It evaluates:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Term frequency"}),"\n",(0,s.jsx)(n.li,{children:"Inverse document frequency"}),"\n",(0,s.jsx)(n.li,{children:"Field normalization"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Lexical search performs well when:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Queries contain explicit keywords"}),"\n",(0,s.jsx)(n.li,{children:"Exact phrase matching is required"}),"\n",(0,s.jsx)(n.li,{children:"Domain terminology is stable"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"semantic-search-vector-search",children:"Semantic Search (Vector Search)"}),"\n",(0,s.jsx)(n.p,{children:"Semantic search represents text as high-dimensional embeddings."}),"\n",(0,s.jsxs)(n.p,{children:["Each document contains a ",(0,s.jsx)(n.code,{children:"dense_vector"})," field generated by an embedding model."]}),"\n",(0,s.jsx)(n.p,{children:"Similarity is measured using:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cosine similarity"}),"\n",(0,s.jsx)(n.li,{children:"Dot product"}),"\n",(0,s.jsx)(n.li,{children:"L2 norm"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Advantages:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Handles paraphrasing"}),"\n",(0,s.jsx)(n.li,{children:"Improves recall"}),"\n",(0,s.jsx)(n.li,{children:"Enables intent-based retrieval"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Tradeoffs:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Requires embedding pipeline"}),"\n",(0,s.jsx)(n.li,{children:"Higher memory usage"}),"\n",(0,s.jsx)(n.li,{children:"Approximate nearest neighbor indexing"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"3-hybrid-retrieval-architecture",children:"3. Hybrid Retrieval Architecture"}),"\n",(0,s.jsx)(n.p,{children:"A typical hybrid retrieval pipeline includes:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Document ingestion"}),"\n",(0,s.jsx)(n.li,{children:"Embedding generation"}),"\n",(0,s.jsx)(n.li,{children:"Vector indexing"}),"\n",(0,s.jsx)(n.li,{children:"Hybrid query execution"}),"\n",(0,s.jsx)(n.li,{children:"Score fusion or reranking"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"User Query\n  \u2193\nEmbedding Generation\n  \u2193\nElasticsearch\n  \u251c\u2500 BM25 match query\n  \u251c\u2500 kNN vector query\n  \u2193\nFusion / Ranking\n  \u2193\nFinal Results\n"})}),"\n",(0,s.jsx)(n.h2,{id:"4-creating-an-index-with-dense-vectors",children:"4. Creating an Index with Dense Vectors"}),"\n",(0,s.jsx)(n.p,{children:"Example index mapping:"}),"\n",(0,s.jsx)(n.h2,{id:"creating-an-index-with-dense-vectors",children:"Creating an index with dense vectors"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'PUT hybrid-index\n{\n  "mappings": {\n    "properties": {\n      "title": { "type": "text" },\n      "content": { "type": "text" },\n      "content_vector": {\n        "type": "dense_vector",\n        "dims": 1536,\n        "index": true,\n        "similarity": "cosine"\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"verifying-index-creation-in-elasticsearch-cloud",children:"Verifying index creation in Elasticsearch Cloud"}),"\n",(0,s.jsx)(n.p,{children:"The index was created successfully using the dev tools console in an Elasticsearch deployment."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Hybrid index created in Elasticsearch Cloud",src:i(9077).A+"",width:"1910",height:"910"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-md",children:"Key considerations:\n- `dims` must match your embedding model output.\n- Vector indexing uses HNSW internally.\n- Memory usage increases with document count and `num_candidates`.\n"})}),"\n",(0,s.jsx)(n.h2,{id:"5-ingesting-documents-with-embeddings",children:"5. Ingesting Documents with Embeddings"}),"\n",(0,s.jsx)(n.p,{children:"Example document:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'POST hybrid-index/_doc/1\n{\n  "title": "Hybrid Retrieval in Elasticsearch",\n  "content": "Combining BM25 and vector similarity improves recall.",\n  "content_vector": [0.0123, -0.9812, ...]\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"ingesting-a-document-with-a-dense-vector-field",children:"Ingesting a document with a dense vector field"}),"\n",(0,s.jsxs)(n.p,{children:["The document was indexed with a 3-dimensional dense vector for demonstration purposes.\n",(0,s.jsx)(n.img,{alt:"Document index created in Elasticsearch Cloud",src:i(5112).A+"",width:"1898",height:"906"})]}),"\n",(0,s.jsx)(n.p,{children:"Embedding generation can be handled:"}),"\n",(0,s.jsx)(n.p,{children:"During ingestion"}),"\n",(0,s.jsx)(n.p,{children:"-In a preprocessing batch job"}),"\n",(0,s.jsx)(n.p,{children:"-In the application layer"}),"\n",(0,s.jsx)(n.p,{children:"-For production systems, embeddings should be versioned to prevent drift."}),"\n",(0,s.jsx)(n.h2,{id:"6-performing-vector-search-knn",children:"6. Performing Vector Search (kNN)"}),"\n",(0,s.jsx)(n.p,{children:"Example kNN query:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'POST hybrid-index/_search\n{\n  "knn": {\n    "field": "content_vector",\n    "query_vector": [0.0213, -0.9123, ...],\n    "k": 10,\n    "num_candidates": 100\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"executing-a-hybrid-search-query",children:"Executing a hybrid search query"}),"\n",(0,s.jsx)(n.p,{children:"The query combines:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"BM25 match on content"}),"\n",(0,s.jsxs)(n.li,{children:["kNN vector similarity\n",(0,s.jsx)(n.img,{alt:"Hybrid search in Elasticsearch Cloud",src:i(6753).A+"",width:"1908",height:"913"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Parameters:"}),"\n",(0,s.jsx)(n.p,{children:"-k: number of returned documents"}),"\n",(0,s.jsx)(n.p,{children:"-num_candidates: controls recall vs latency tradeoff"}),"\n",(0,s.jsx)(n.p,{children:"-Higher num_candidates improves recall but increases compute cost."}),"\n",(0,s.jsx)(n.h2,{id:"7-implementing-hybrid-queries",children:"7. Implementing Hybrid Queries"}),"\n",(0,s.jsx)(n.p,{children:"Elasticsearch allows combining lexical and vector retrieval."}),"\n",(0,s.jsx)(n.p,{children:"Example hybrid search:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'POST hybrid-index/_search\n{\n  "query": {\n    "bool": {\n      "should": [\n        {\n          "match": {\n            "content": "hybrid retrieval system"\n          }\n        }\n      ]\n    }\n  },\n  "knn": {\n    "field": "content_vector",\n    "query_vector": [0.0213, -0.9123, ...],\n    "k": 10,\n    "num_candidates": 100\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Hybrid strategies include:"}),"\n",(0,s.jsx)(n.p,{children:"-Score blending"}),"\n",(0,s.jsx)(n.p,{children:"-Weighted combination"}),"\n",(0,s.jsx)(n.p,{children:"-Reciprocal Rank Fusion (RRF)"}),"\n",(0,s.jsx)(n.p,{children:"-Application-level reranking"}),"\n",(0,s.jsx)(n.h2,{id:"8-performance-and-scaling-considerations",children:"8. Performance and Scaling Considerations"}),"\n",(0,s.jsx)(n.p,{children:"HNSW Indexing\nElasticsearch uses HNSW (Hierarchical Navigable Small World graphs) for approximate nearest neighbor search."}),"\n",(0,s.jsx)(n.p,{children:"Key tuning areas:"}),"\n",(0,s.jsx)(n.p,{children:"-num_candidates"}),"\n",(0,s.jsx)(n.p,{children:"-Memory allocation"}),"\n",(0,s.jsx)(n.p,{children:"-Shard count"}),"\n",(0,s.jsx)(n.p,{children:"Memory Management\n-Vector search increases heap usage."}),"\n",(0,s.jsx)(n.p,{children:"Recommendations:"}),"\n",(0,s.jsx)(n.p,{children:"-Use fewer shards for vector-heavy workloads"}),"\n",(0,s.jsx)(n.p,{children:"-Monitor segment merges"}),"\n",(0,s.jsx)(n.p,{children:"-Enable slow logs"}),"\n",(0,s.jsx)(n.p,{children:"-Load test hybrid queries before production"}),"\n",(0,s.jsx)(n.p,{children:"-Latency Tradeoffs\n-Hybrid queries introduce:"}),"\n",(0,s.jsx)(n.p,{children:"Additional compute cost"}),"\n",(0,s.jsx)(n.p,{children:"-Scoring overhead"}),"\n",(0,s.jsx)(n.p,{children:"-Potential tail latency spikes"}),"\n",(0,s.jsx)(n.p,{children:"Mitigation:"}),"\n",(0,s.jsx)(n.p,{children:"-Cache frequent queries"}),"\n",(0,s.jsx)(n.p,{children:"-Limit vector candidate pool"}),"\n",(0,s.jsx)(n.p,{children:"-Use reranking selectively"}),"\n",(0,s.jsx)(n.h2,{id:"9-production-pitfalls",children:"9. Production Pitfalls"}),"\n",(0,s.jsx)("strong",{children:"Common issues:"}),"\n",(0,s.jsx)(n.p,{children:"-Embedding drift after model upgrades"}),"\n",(0,s.jsx)(n.p,{children:"-Large vector fields increasing storage cost"}),"\n",(0,s.jsx)(n.p,{children:"-Relevance inconsistencies between lexical and semantic scoring"}),"\n",(0,s.jsx)(n.p,{children:"-Query performance degradation at scale"}),"\n",(0,s.jsx)("strong",{children:"Best practices:"}),"\n",(0,s.jsx)(n.p,{children:"-Version embeddings"}),"\n",(0,s.jsx)(n.p,{children:"-Benchmark recall and latency"}),"\n",(0,s.jsx)(n.p,{children:"-Monitor cluster memory"}),"\n",(0,s.jsx)(n.p,{children:"-Test failure scenarios"}),"\n",(0,s.jsx)(n.h2,{id:"10-when-to-use-hybrid-retrieval",children:"10. When to Use Hybrid Retrieval"}),"\n",(0,s.jsx)(n.p,{children:"Hybrid retrieval is particularly effective for:"}),"\n",(0,s.jsx)(n.p,{children:"-AI assistants"}),"\n",(0,s.jsx)(n.p,{children:"-RAG pipelines"}),"\n",(0,s.jsx)(n.p,{children:"-Knowledge bases"}),"\n",(0,s.jsx)(n.p,{children:"-Support systems"}),"\n",(0,s.jsx)(n.p,{children:"-Semantic product search"}),"\n",(0,s.jsx)(n.p,{children:"Hybrid retrieval combines the precision of lexical search with the semantic understanding of vector similarity."}),"\n",(0,s.jsx)(n.p,{children:"Elasticsearch provides:"}),"\n",(0,s.jsx)(n.p,{children:"-Native dense vector fields"}),"\n",(0,s.jsx)(n.p,{children:"-Approximate kNN search"}),"\n",(0,s.jsx)(n.p,{children:"-Flexible query composition"}),"\n",(0,s.jsx)(n.p,{children:"-Production-grade scalability"}),"\n",(0,s.jsx)(n.p,{children:"When implemented thoughtfully, hybrid retrieval improves search quality while maintaining operational performance."})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},5112(e,n,i){i.d(n,{A:()=>r});const r=i.p+"assets/images/document-indexed-4ab53c1b8857bb3001bde3e3880855c2.png"},9077(e,n,i){i.d(n,{A:()=>r});const r=i.p+"assets/images/hybrid-index-created-d63dff740809af456fcd69f2383caaab.png"},6753(e,n,i){i.d(n,{A:()=>r});const r=i.p+"assets/images/hybrid-search-results-9d1cd02c3bd7bbf5c41b2b1809ecb6db.png"},8453(e,n,i){i.d(n,{R:()=>a,x:()=>l});var r=i(6540);const s={},c=r.createContext(s);function a(e){const n=r.useContext(c);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);